= Dr Duke User Guide

App-Specific Terms:

* This app manages multiple Patients. Each Patient has one or more Impressions (diagnoses), and each Impression is supported by Evidence and treated by Treatments. Evidence consists of Observations and Results. Treatments consist of Plans, Investigations and Medicine. 
* The user navigates between different contexts. Each context is associated with a particular set of data to display - a particular display screen.
* `priority` refers to how critical a Treatment or Evidence is. 0 means not urgent, excluding the item from the criticality system, 1 means critical. The other values are not defined specifically but the greater they are, the lower the priority. These lower priority levels are meant to remain flexible for the user to provide his desired level of fine-graining and task management.
** `priority` 1 generally refers to something that needs to be followed up on or investigated immediately, e.g. signs of severe complications. `priority` 1 items will be displayed prominently to remind the user to respond to it when treating the patient. 
* `status` refers to the stage of completion of a Treatment. The textual descriptions for each stage of completion are stored in the `statusArr` (and referred to as `<status name>`). 

# Usage

Comments/Notes:

* Since there is a lot of fairly complex data to manage, the input system is stateful - different commands mean different things based on the current context. 
* This would require some tracking and interfacing between the UI and the Logic (e.g. the internal logic needs to know which patient is being displayed as patient #1). This can be done by creating an array of integers mapping the on-screen indices to the internal ArrayList indices.
* If user input is ambiguous, we can show a window of possible options to disambiguate between, or give the user the option to edit the text in a buffer. The disambiguation window and code can be reused - create an abstract DukeObject class for our data items.

Specification syntax:

* `[]` -> optional element of a command
* `<>` -> variable input, specified within bracket
* `(a|b|c)` -> input that can be one of several possible options, in this case `a`, `b` or `c`
* `"<>"` -> string, must be surrounded by quotes if it contains a space, and cannot start with a -
* `[]*` -> 0 or more of the contents of [], separated by spaces

Reused patterns:

* _patient_id_: `(<patient index>|"part of name>"|-b <bed number>)`
* _string_or_idx_: `(<index>|"<search string>")`
** `<index>` refers to the index assigned to the object in the display. `<search string>` will be searched for in the names of all relevant objects.
* _type_: (`-m[edicine]`|`-i[nv(x|estigation)]`|`-p[lan]`|`-o[bservation]`|`-r[esult]`)

Parsing rules:

* Switches can be in any order
* Switches with optional parts of their names can be recognised with any portion of the optional part. E.g. `-crit` matches `-c[ritical]`. Disambiguation can be used as confirmation if part of the input matches the first part of the switch, but subsequent parts are wrong.
* We may implement a system similar to the above for command names

## Contexts

Commands that are present in multiple contexts will be mentioned in just one context, and all contexts in which they are available will be listed.

### Home 

Show several (10?) numbered panels displaying a summary of the critical details of some Patients: name, bed number, primary diagnosis, and number of critical issues.

#### `help` - Display a context-specific list of commands and options [[home-help]]

Format: `help`

_Available in:_ <<Home>>, <<Patient>>, <<Impression>>, <<Treatment and Evidence>>

This will be available in every context, and will function essentially the same way, just with different commands.

#### `next` - Display next page of Patients [[home-next]]

_Remove if we can have a scrolling display of Patients instead_

Format: `next` 

_Available in:_ <<Home>>, <<Patient>>, <<Impression>> 

#### `prev` - Display next page of Patients [[home-prev]]

_Remove if we can have a scrolling display of Patients instead_

For different contexts, scrolls forward in all lists that can be scrolled.

Format: `prev`

_Available in:_ <<Home>>, <<Patient>>, <<Impression>>

For different contexts, scrolls backward in all lists that can be scrolled.

#### `critical` - Display all critical observations and plans of all Patients [v2.0?]

If used in current version, provide support for open command to open items retrieved in this way.

Format: `critical`

We can probably cheat and use the disambiguation engine to pull up a window of all critical dukeobjects, giving the user the choice to navigate to any particular one, or to close the window

#### `discharge` - Generate a discharge report for the Patient and delete him from the system [[home-discharge]] 

Format: `discharge _patient_id_ [-sum[mary] <discharge summary>]`

The discharge report will contain all information being tracked regarding the Patient, and an optional discharge summary that can be specified in the command. In v1.4, Patients will simply be deleted after the report is generated. In v2.0, they will be archived.

#### `archive` - Display discharged Patients  [v2.0]

Format: `archive`

#### `open` - Go to a more detailed view of a particular Patient

Format: `open _patient_id_ [-i[mpression] [<impression index>]]`

If a string is supplied, search for the name and present a list of results (either through the cli or just a pop-up search window). If the `-b` switch is used, look up the bed number. If the `-i` switch is used, go to the impression specified by the index, or go to the primary impression for that particular Patient if no index is specified. 

#### `new` - Add a new Patient to the system

Format: `new -n[ame] "<name>" -b[ed] <bed number> -a[llergies] "<allergies>" [<optional switch>]*`

Optional switches:

* `-g[o]`
* `-h[eight] <height>` 
* `-w[eight] <weight>` 
* `-ag[e] <age>`
* `-num[ber] <number>`
* `-ad[dress] "<address>"`
* `-hi[story] "<history>"`

The Patient's name, bed number and allergies must be specified. The other fields are assigned to `null` by default but can be edited later on. The `-g[o]` switch goes to the Patient's page after it is created.

#### `undo` - Undo the previous command [[home-undo]]

Format: `undo <number of commands>`

_Available in:_ <<Home>>, <<Patient>>, <<Impression>>, <<Treatment and Evidence>>

You can undo up to the last 10? commands. Only commands that affect the state of the system count against this limit.

#### `redo` - Redo a command that has been undone [[home-redo]]

Format: `redo <number of commands>`

_Available in:_ <<Home>>, <<Patient>>, <<Impression>>, <<Treatment and Evidence>>

After undoing some commands, sending any command other than `undo` or `redo` will clear the redo stack. The undone commands cannot be redone from that point onwards.

### Patient 

Show a detailed view of a Patient, displaying in separate panels:

* All personal details
* A list of critical Treatments and Evidence (`priority` 1)
* A list of Investigations to follow up on (i.e. all current investigations; completed investigations should be stored as Results)
* Each Impression, with its name and an excerpt of its description

Inherits: <<home-help,`help`>>, <<home-next,`next`>>, <<home-prev,`prev`>>, <<home-undo,`undo`>>, <<home-redo,`redo`>> 

#### `back` - Go back to previous context [[patient-back]]

Format: `back`

_Available in:_ <<Patient>>, <<Impression>>, <<Treatment and Evidence>>

This will go back to the context that the user came from. A context stack will be maintained.

#### `up` - Go up to next-higher context [[patient-up]]

Format: `up`

_Available in:_ <<Patient>>, <<Impression>>, <<Treatment and Evidence>>

This will go to the context hierarchically above the user's context. In this case, it will go back to <<Home>>. For an <<Impression>>, it would go back to the <<Patient>> associated with it.

#### `new` - Add a new Impression to this Patient

Format: `new -n[ame] "<name>" -d[escription] "<description>"`

#### `open` - Open a critical or Investigation item listed on the page, or an Impression

Format: `open ("<search string>"|-c[ritical] _string_or_idx_|-in[v(x|estigation)] _string_or_idx_|-i[mpression] _string_or_idx_)`

#### `edit` - Edit one of the details of the Patient [[patient-edit]]

Format: `edit [-a[ppend]] <switch> [<new value>] [<switch> [<new value>]]*`

If `<new value>` is not supplied, open a text box with the current value loaded inside, for the user to edit. `-a` will append `<new value>` to the current value for string-valued fields. 

Switches and corresponding new value format:

* `-n[ame] "<name>"`
* `-b[ed] <bed number>`
* `-a[llergies] "<allergies>"`
* `-h[eight] <height>` 
* `-w[eight] <weight>` 
* `-ag[e] <age>`
* `-num[ber] <number>`
* `-ad[dress] "<address>"`
* `-hi[story] "<history>"`

#### `discharge` - Generate a discharge report for the Patient and delete him from the system

Format: `discharge [-sum[mary] <discharge summary>]`

Functionally the same as <<home-discharge,`discharge` in the Home context>>.

#### `report` - Generate a text file containing all data on this patient [[patient-report]]

Format: `report`

Report will be generated in the format required by the hospital's internal systems. In v2.0, the hospital's required format can be specified.

_Available in:_ <<Patient>>, <<Impression>>, <<Treatment and Evidence>>

#### `round` - Ward round mode [v2.0] 

Format: `round`

_Available in:_ <<Patient>>, <<Impression>>, <<Treatment and Evidence>> [v2.0]

An input mode designed for maximum speed input. Only the first word of the input, which should be a sequence of control characters, will determine where the input is directed. Everything else will be treated as input. 

### Impression

Show a detailed view of an Impression, displaying in separate panels:

* The name and full description of the Impression
* A list of Evidence for the Impression, sorted by default with critical items first
* A list of Treatments for the Impression, sorted by default with critical items first, followed by investigations that require follow-up
* A small panel with the patient's allergies

Inherits: <<home-help,`help`>>, <<home-next,`next`>>, <<home-prev,`prev`>>, <<patient-back,`back`>>, <<patient-up,`up`>>, <<patient-report,`report`>>, <<home-undo,`undo`>>, <<home-redo,`redo`>> 

#### `new` - Add a new Treatment (Investigation, Medicine or Plan) or Evidence (Observation or Result) item to this Impression

Format: `new _type_ <relevant switches>`

[[type-table]]
[cols=2*,options="header"]
|===
|Type
|Relevant Switches

|`-m[edicine]`
a| 
* `-n[ame] "<name>"` - Required
* `-sta[tus] ("<status name>"\|<status idx>)` - Default: 0 (not ordered)
* `-d[ose] "<dose>"` - Required
* `-da[te] "<start date>"` - Default: Today
* `-du[ration] "<duration of course>"` - Required
* `-pri[ority] <priority idx>` - Default: 0 (not urgent)

|`-i[nv(x\|estigation)]`
a| 
* `-n[ame] "<name>"` - Required
* `-sta[tus] ("<status name>"\|<status idx>)` - Default: 0 (not ordered)
* `-sum[mary] "<summary>"` - Default: ""
* `-pri[ority] <priority idx>` - Default: 0 (not urgent)

|`-p[lan]`
a| 
* `-n[ame] "<name>"` - Required
* `-sta[tus] ("<status name>"\|<status idx>)` - Default: 0 (not ordered)
* `-sum[mary] "<summary>"` - Default: ""
* `-pri[ority] <priority idx>` - Default: 0 (not urgent)

|`-o[bservation]`
a| 
* `-n[ame] "<name>"` 
* `-sum[mary] "<summary>"`
* `-subj[ective]`
* `-obj[ective]` - Default: objective observations
* `-pri[ority] <priority idx>`

|`-r[esult]`
a| 
* `-n[ame] "<name>"`
* `-sum[mary] "<summary>"`
* `-pri[ority] <priority idx>` - Default: 0 (not urgent)

|===

`<status name>` is a case-insensitive substring of the `statusArr` entry of that particular object, while `<status idx>` is its numerical representation.

#### `open` - Open a Treatment or Evidence item listed on this page

Format: `open ("<search string>"|-e[vidence] _string_or_idx_|-t[reatment] _string_or_idx_)`

This will open a new context for the specific Treatment or Evidence identified.

#### `edit` - Edit one of the details of the Impression

Format: `edit [-a[ppend]] [_type_ _string_or_idx_] <switch> [<new value>] [<switch> [<new value>]]`

If input without `_type_ _string_or_idx_`, it is functionally the same as <<patient-edit,`edit` for Patients>>, but with different possible switches.

Switches and corresponding new value formats:

* `-n[ame] "<name>"`
* `-d[escription] "<description>"`

With this aditional switch, the command instead edits an associated Treatment or Object. The possible values for `<switch>` and `<new value>` can now be found in the <<type-table,table>> for `new`.

#### `priority` - Mark a Treatment or Evidence as a certain priority level

Format: `priority ("<search string>"|-e[vidence] _string_or_idx_|-t[reatment] _string_or_idx_) -s <new priority>`

`<new priority>` must be a non-negative integer.

#### `status` - Update the completion status of a Treatment

Format: `status _string_or_idx_ [-s ("<status name>"|<status idx>)]`

If `-s` is not specified, `status` will be incremented by 1, unless it is at the maximum value.

#### `result` - Convert an Investigation that has been completed into a Result

Format: `result _string_or_idx_ -sum[mary] "<result summary>"`

_idx_ in this scope will refer to an index in the Treatment list. The result summary will be appended to the Investigation summary.

#### `find` - Find items matching certain criteria

Format: `find ["<search string>"] [_type_]* [-pri[ority] <priority>] [-sta[tus] ("<status name>"|<status idx>)]`

Display a list of all Treatments and Evidence matching the criteria specified in the search.

### Treatment and Evidence

All Treatment and Evidence contexts (one for each type of Treatment and each type of Evidence) behave in essentially the same way: they display all their data in full. This section will list the commands that they have in common. Each individual Treatment and Evidence context is assumed to have all these commands, and all the commands in this inheritance list.

Inherits: <<home-help,`help`>>, <<home-next,`next`>>, <<home-prev,`prev`>>, <<patient-back,`back`>>, <<patient-up,`up`>>, <<patient-report,`report`>>, <<home-undo,`undo`>>, <<home-redo,`redo`>>

#### `edit` - Edit one of the details of the Treatment or Evidence

Format: `edit [-a[ppend]] <switch> [<new value>] [<switch> [<new value>]]`

The possible values for `<switch>` and `<new value>` can now be found in the <<type-table,table>> for `new` in the Impression context.

#### `priority` - Mark the Treatment or Evidence as a certain priority level

Format: `priority <new priority>`

`<new priority>` must be a non-negative integer.

### Treatment

Contains everything in <<Treatment and Evidence>>.

#### `status` - Update the completion status of a Treatment

Format: `status [("<status name>"|<status idx>)]`

If no `<status name>` or `<status idx>` is specified, `status` will be incremented by 1, unless it is at the maximum value.

### Investigation

Contains everything in <<Treatment and Evidence>>.

#### `result` - Convert the Investigation into a Result after completion

Format: `result -sum[mary] "<result summary>"`

The result summary will be appended to the Investigation summary.
